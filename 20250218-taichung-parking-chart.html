<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taichung Parking - Chart</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/mao.css">
</head>

<body class="bg-02">
    <div class="banner bg-cover" style="background-image: url(images/photo07.jpg); height: 280px;">
        <div class="display-2 fw-900 text-white p-5">Taichung Parking - Chart</div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div>
                    <canvas id="myChart01"></canvas>
                </div>
            </div>
            <div class="col-12">
                <div>
                    <canvas id="myChart02"></canvas>
                </div>
            </div>
            <div class="col-12">
                <div>
                    <canvas id="myChart03"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/mao-auth.js"></script>
    <script>
        var regionTitle = [];
        var counter = [];
        var regionData = [];
        var mychart01;
        var mychart02;
        var mychart03;
        $(function () {
            const ctx01 = document.getElementById('myChart01');
    
            mychart01 = new Chart(ctx01, {
                type: 'bar',
                data: {
                    labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                    datasets: [{
                        label: ' 停車場數量',
                        data: [12, 19, 3, 5, 2, 3],
                        borderWidth: 1,
                        backgroundColor: [
                            'rgb(255, 99, 132)',
                            'rgb(54, 162, 235)',
                            'rgb(255, 205, 86)',
                            'rgb(75, 192, 192)',
                            'rgb(153, 102, 255)',
                            'rgb(255, 159, 64)',
                            'rgb(100, 205, 10)',
                            'rgb(0, 205, 86)',
                            'rgb(255, 99, 71)',
                            'rgb(0, 191, 255)',
                            'rgb(148, 0, 211)',
                            'rgb(255, 69, 0)'
                        ],
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            const ctx02 = document.getElementById('myChart02');
    
            mychart02 = new Chart(ctx02, {
                type: 'line',
                data: {
                    labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                    datasets: [{
                        label: ' 停車場數量',
                        data: [12, 19, 3, 5, 2, 3],
                        borderWidth: 1,
                        backgroundColor: [
                            'rgb(255, 99, 132)',
                            'rgb(54, 162, 235)',
                            'rgb(255, 205, 86)',
                            'rgb(75, 192, 192)',
                            'rgb(153, 102, 255)',
                            'rgb(255, 159, 64)',
                            'rgb(100, 205, 10)',
                            'rgb(0, 205, 86)',
                            'rgb(255, 99, 71)',
                            'rgb(0, 191, 255)',
                            'rgb(148, 0, 211)',
                            'rgb(255, 69, 0)'
                        ],
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            const ctx03 = document.getElementById('myChart03');
    
            mychart03 = new Chart(ctx03, {
                type: 'pie',
                data: {
                    labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                    datasets: [{
                        label: ' 停車場數量',
                        data: [12, 19, 3, 5, 2, 3],
                        borderWidth: 1,
                        backgroundColor: [
                            'rgb(255, 99, 132)',
                            'rgb(54, 162, 235)',
                            'rgb(255, 205, 86)',
                            'rgb(75, 192, 192)',
                            'rgb(153, 102, 255)',
                            'rgb(255, 159, 64)',
                            'rgb(100, 205, 10)',
                            'rgb(0, 205, 86)',
                            'rgb(255, 99, 71)',
                            'rgb(0, 191, 255)',
                            'rgb(148, 0, 211)',
                            'rgb(255, 69, 0)'
                        ],
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            $.ajax({
                type: "GET",
                url: "js/taichungParking.json",
                dataType: "json",
                async: false,
                success: showdata,
                error: function () {
                    Swal.fire({
                        title: "API 介接錯誤",
                        text: "js/taichungParking.json",
                        icon: "error"
                    });
                }
            });

        });

        function showdata(data) {
            data.forEach(function (item) {
                getRegion = item["地址"].substring(item["地址"].indexOf("市", 0)+1, item["地址"].indexOf("區", 0) + 1);
                if(getRegion.length == 2 || getRegion.length == 3 ){
                    if(getRegion != "臺中市"){
                        if (counter[getRegion] == undefined) {
                            counter[getRegion] = regionData.length;
                            regionData.push(new Array());
                            regionTitle[counter[getRegion]] = getRegion;
                        }
                        regionData[counter[getRegion]].push(item);
                    }
                    
                }
            });

            mychart01.data.labels = [];
            mychart01.data.datasets[0].data = [];
            mychart02.data.labels = [];
            mychart02.data.datasets[0].data = [];
            mychart03.data.labels = [];
            mychart03.data.datasets[0].data = [];
            regionTitle.forEach(function(item){
                mychart01.data.labels.push(item);
                mychart01.data.datasets[0].data.push(regionData[counter[item]].length);
                mychart02.data.labels.push(item);
                mychart02.data.datasets[0].data.push(regionData[counter[item]].length);
                mychart03.data.labels.push(item);
                mychart03.data.datasets[0].data.push(regionData[counter[item]].length);
            })
            mychart01.update();
            mychart02.update();
            mychart03.update();
        }

    </script>
</body>

</html>