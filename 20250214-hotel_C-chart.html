<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Data - Chart</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/mao.css">
</head>

<body class="bg-02">
    <section id="s02" class="bg-01">
        <div class="container">
            <nav class="navbar navbar-expand-lg">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#">
                        <i class="fa-solid fa-paw fa-2x" style="color: var(--bgcolor02);"></i>
                        <h1>控制台</h1>
                    </a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                        data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item">
                                <a class="nav-link active" aria-current="page" href="#">首頁</a>
                            </li>

                            <li class="nav-item">
                                <a class="nav-link" href="#">保留功能</a>
                            </li>
                            <li class="nav-item d-none ms-2 h5" id="s02_control_panel_btn">
                                <a class="nav-link fw-900" style="border-radius: 10px; color: var(--bgcolor02);"
                                    href="SPA-member-control-panel_v1.html" target="_blank">控制台</a>
                            </li>
                        </ul>
                        <div>
                            <span class="h5 me-3 d-none align-content-center" id="s02_username_showtext"
                                style="color: var(--bgcolor03);">歡迎會員: <span class="h4 fw-900"
                                    style="color: var(--bgcolor02);" id="s02_username_text">XXX</span></span>
                            <button class="btn bg-02 d-none tx-03" id="s02_logout_btn">登出</button>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </section>
    <div class="container-fluid my-5">
        <div class="row">
            <div class="col-md-4">
                <ul class="list-group" id="citylist">
                    <li class="list-group-item">台中市</li>
                </ul>
            </div>
            <div class="col-md-8">
                <div class="row">
                    <div class="col-12" style="height:250px;">
                        <canvas id="myChart01"></canvas>
                    </div>
                    <div class="col-12" style="height:250px;">
                        <canvas id="myChart02"></canvas>
                    </div>
                    <div class="col-12" style="height:500px;width: 500px;">
                        <canvas id="myChart03"></canvas>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/mao-auth.js"></script>
    <script>
        var hotelData = [];
        var selectCity;
        var regionTitle = [];
        var counter = [];
        var regionData = [];
        var mychart01;
        var mychart02;
        var mychart03;
        $(function () {
            const ctx01 = document.getElementById('myChart01');
            mychart01 = new Chart(ctx01, {
                type: 'bar',
                data: {
                    labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                    datasets: [{
                        label: ' 旅館數量',
                        data: [12, 19, 3, 5, 2, 3],
                        borderWidth: 1,
                        backgroundColor: [
                            'rgb(255, 99, 132)',
                            'rgb(54, 162, 235)',
                            'rgb(255, 205, 86)',
                            'rgb(75, 192, 192)',
                            'rgb(153, 102, 255)',
                            'rgb(255, 159, 64)',
                            'rgb(100, 205, 10)',
                            'rgb(0, 205, 86)',
                            'rgb(255, 99, 71)',
                            'rgb(0, 191, 255)',
                            'rgb(148, 0, 211)',
                            'rgb(255, 69, 0)'
                        ],
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            const ctx02 = document.getElementById('myChart02');
            mychart02 = new Chart(ctx02, {
                type: 'line',
                data: {
                    labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                    datasets: [{
                        label: ' 旅館數量',
                        data: [12, 19, 3, 5, 2, 3],
                        borderWidth: 1,
                        backgroundColor: [
                            'rgb(255, 99, 132)',
                            'rgb(54, 162, 235)',
                            'rgb(255, 205, 86)',
                            'rgb(75, 192, 192)',
                            'rgb(153, 102, 255)',
                            'rgb(255, 159, 64)',
                            'rgb(100, 205, 10)',
                            'rgb(0, 205, 86)',
                            'rgb(255, 99, 71)',
                            'rgb(0, 191, 255)',
                            'rgb(148, 0, 211)',
                            'rgb(255, 69, 0)'
                        ],
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            const ctx03 = document.getElementById('myChart03');
            mychart03 = new Chart(ctx03, {
                type: 'pie',
                data: {
                    labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                    datasets: [{
                        label: ' 旅館數量',
                        data: [12, 19, 3, 5, 2, 3],
                        borderWidth: 1,
                        backgroundColor: [
                            'rgb(255, 99, 132)',
                            'rgb(54, 162, 235)',
                            'rgb(255, 205, 86)',
                            'rgb(75, 192, 192)',
                            'rgb(153, 102, 255)',
                            'rgb(255, 159, 64)',
                            'rgb(100, 205, 10)',
                            'rgb(0, 205, 86)',
                            'rgb(255, 99, 71)',
                            'rgb(0, 191, 255)',
                            'rgb(148, 0, 211)',
                            'rgb(255, 69, 0)'
                        ],
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            $.ajax({
                type: "GET",
                url: "js/hotel_C_f.json",
                dataType: "json",
                async: false,
                success: function (data) {
                    hotelData = data.XML_Head.Infos.Info;
                },
                error: function () {
                    Swal.fire({
                        title: "API 介接錯誤",
                        text: "js/hotel_C_f.json",
                        icon: "error"
                    });
                }
            });

            $.ajax({
                type: "GET",
                url: "js/CityCountyData.json",
                dataType: "json",
                async: false,
                success: function (data) {
                    $("#citylist").empty();
                    data.forEach(function (item) {
                        var strHTML = `<li class="list-group-item" data-name="${item.CityName}">${item.CityName}</li>`;
                        $("#citylist").append(strHTML);
                    });
                },
                error: function () {
                    Swal.fire({
                        title: "API 介接錯誤",
                        text: "js/CityCountyData.json",
                        icon: "error"
                    });
                }
            });

            $("#citylist .list-group-item").click(function () {
                selectCity = $(this).data("name");

                regionData = [];
                regionTitle = [];
                counter = [];

                var filterData = [];
                hotelData.forEach(function (item) {
                    if (item.Region == selectCity) {
                        filterData.push(item);
                    }
                });

                filterData.forEach(function (item) {
                    getRegion = item.Town;
                    if (counter[getRegion] == undefined) {
                        counter[getRegion] = regionData.length;
                        regionData.push(new Array());
                        regionTitle[counter[getRegion]] = getRegion;
                    }
                    regionData[counter[getRegion]].push(item);
                });
                mychart01.data.labels = [];
                mychart01.data.datasets[0].data = [];
                mychart02.data.labels = [];
                mychart02.data.datasets[0].data = [];
                mychart03.data.labels = [];
                mychart03.data.datasets[0].data = [];

                regionTitle.forEach(function (item) {
                    mychart01.data.labels.push(item);
                    mychart01.data.datasets[0].data.push(regionData[counter[item]].length);
                    mychart02.data.labels.push(item);
                    mychart02.data.datasets[0].data.push(regionData[counter[item]].length);
                    mychart03.data.labels.push(item);
                    mychart03.data.datasets[0].data.push(regionData[counter[item]].length);
                })
                mychart01.update();
                mychart02.update();
                mychart03.update();
            });

        });

    </script>
</body>

</html>